(self.webpackChunkacmsWebpackJsonp=self.webpackChunkacmsWebpackJsonp||[]).push([[6637],{31105:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(64694);let o;const n={region:ACMS.Config.s2dRegion||"JP"};e.default=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o)return o;const i=new s.Loader(t,{...n,...e});return o=i.load(),o}},78385:function(t,e,i){var s=i(24994);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(i(43693)),n=s(i(31105));const a={latInput:'.js-map_editable-lat, input[name^="map_lat_"]',lngInput:'.js-map_editable-lng, input[name^="map_lng_"]',zoomInput:'.js-map_editable-zoom, input[name^="map_zoom_"]',pitchInput:'.js-map_editable-pitch, input[name^="map_view_pitch_"]',zoomViewInput:'.js-map_editable-zoom-view, input[name^="map_view_zoom_"]',headingInput:'.js-map_editable-heading, input[name^="map_view_heading_"]',modeSwitcher:'.js-map_editable-activate, input[type="checkbox"][name^="map_view_activate_"]',searchInput:".js-editable_map-search_text",searchButton:".js-editable_map-search_button",mapRoot:".js-map_editable-container",apiKey:ACMS.Config.googleApiKey};e.default=class{constructor(t,e){(0,o.default)(this,"options",void 0),(0,o.default)(this,"google",null),(0,o.default)(this,"googleMap",null),(0,o.default)(this,"googleMapMarker",null),(0,o.default)(this,"value",void 0),(0,o.default)(this,"container",void 0),(0,o.default)(this,"mapRoot",void 0),(0,o.default)(this,"latInput",void 0),(0,o.default)(this,"lngInput",void 0),(0,o.default)(this,"zoomInput",void 0),(0,o.default)(this,"pitchInput",null),(0,o.default)(this,"zoomViewInput",null),(0,o.default)(this,"headingInput",null),(0,o.default)(this,"modeSwitcher",null),(0,o.default)(this,"searchInput",null),(0,o.default)(this,"searchButton",null),(0,o.default)(this,"eventRegistry",new Map);const i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error("Container element not found");this.container=i,this.options={...a,...e};const s=this.getInputElement(this.options.latInput,this.container),n=this.getInputElement(this.options.lngInput,this.container),h=this.getInputElement(this.options.zoomInput,this.container),r=this.getInputElement(this.options.pitchInput,this.container),l=this.getInputElement(this.options.zoomViewInput,this.container),p=this.getInputElement(this.options.headingInput,this.container),g=this.getInputElement(this.options.modeSwitcher,this.container),u=this.getInputElement(this.options.searchInput,this.container),c=this.getButtonElement(this.options.searchButton,this.container),d=this.getElement(this.options.mapRoot,this.container);if(!s)throw new Error("Latitude input element is required");if(!n)throw new Error("Longitude input element is required");if(!h)throw new Error("Zoom input element is required");if(!d)throw new Error("Map root element is required");if(this.latInput=s,this.lngInput=n,this.zoomInput=h,this.pitchInput=r,this.zoomViewInput=l,this.headingInput=p,this.modeSwitcher=g,this.searchInput=u,this.searchButton=c,this.mapRoot=d,this.value={type:"ROADMAP",lat:0,lng:0,zoom:0,streetView:{heading:0,pitch:0,zoomView:0},...this.options.defaultValue},d instanceof HTMLImageElement){const t=document.createElement("div");t.className=d.className,t.style.cssText=getComputedStyle(d).cssText,t.style.width=`${d.width}px`,t.style.height=`${d.height}px`,d.parentNode?.replaceChild(t,d),this.mapRoot=t}}async init(){if(this.google)return this;try{return this.google=await(0,n.default)(this.options.apiKey),this.setValue(),this.setupEventListeners(),this.createMap(this.options.mapOptions),this.toggleStreetView(),this}catch(t){throw new Error(`Failed to initialize Google Maps: ${t}`)}}getElement(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;return t?"string"==typeof t?e.matches&&e.matches(t)?e:e.querySelector(t):t:null}getInputElement(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;const i=this.getElement(t,e);return i instanceof HTMLInputElement?i:null}getButtonElement(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;const i=this.getElement(t,e);return i instanceof HTMLButtonElement?i:null}setupEventListeners(){const t=()=>{if(!this.google)return;this.setValue();const t=new this.google.maps.LatLng(this.value.lat,this.value.lng);this.googleMap&&this.googleMap.panTo(t),this.googleMapMarker&&this.googleMapMarker.setPosition(t),this.emitChange()};if(this.latInput.addEventListener("change",t),this.lngInput.addEventListener("change",t),this.eventRegistry.set(this.latInput,[{type:"change",listener:t}]),this.eventRegistry.set(this.lngInput,[{type:"change",listener:t}]),this.zoomInput){const t=()=>{this.googleMap&&(this.googleMap.setZoom(this.value.zoom),this.setValue(),this.emitChange())};this.zoomInput.addEventListener("change",t),this.eventRegistry.set(this.zoomInput,[{type:"change",listener:t}])}if(this.modeSwitcher){const t=()=>{this.toggleStreetView(),this.emitChange()};this.modeSwitcher.addEventListener("change",t),this.eventRegistry.set(this.modeSwitcher,[{type:"change",listener:t}])}this.setupSearch()}createMap(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.google)return;const e=document.createElement("div");e.style.height="100%",this.mapRoot.replaceChildren(e);const i=new this.google.maps.LatLng(this.value.lat,this.value.lng);this.googleMap=new this.google.maps.Map(e,{zoom:this.value.zoom,center:i,mapTypeId:this.google.maps.MapTypeId.ROADMAP,gestureHandling:"cooperative",...t}),this.registerMapEvents(),this.createMarker()}registerMapEvents(){this.google&&this.googleMap&&this.zoomInput&&this.google.maps.event.addListener(this.googleMap,"zoom_changed",()=>{this.googleMap&&this.zoomInput&&(this.zoomInput.value=this.googleMap.getZoom().toString(),this.setValue(),this.emitChange())})}unregisterMapEvents(){this.google&&this.googleMap&&this.google.maps.event.clearInstanceListeners(this.googleMap)}createMarker(){if(!this.google||!this.googleMap)return;const t=this.googleMap.getCenter();this.googleMapMarker=new this.google.maps.Marker({position:t,map:this.googleMap,draggable:!0}),this.google.maps.event.addListener(this.googleMapMarker,"dragend",t=>{this.setPosition(t.latLng),this.emitChange()})}createPanorama(){if(!this.google||!this.googleMap)return null;const t=this.googleMap.getCenter(),e={position:{lat:t.lat(),lng:t.lng()},pov:{heading:this.value.streetView.heading,pitch:this.value.streetView.pitch},zoom:this.value.streetView.zoomView},i=this.googleMap.getDiv();return new this.google.maps.StreetViewPanorama(i,e)}registerStreetViewEvents(){if(!this.google||!this.googleMap)return;const t=this.googleMap.getStreetView();this.google.maps.event.addListener(t,"pov_changed",()=>{this.updateStreetViewInputs(),this.emitChange()}),this.google.maps.event.addListener(t,"position_changed",()=>{const e=t.getPosition();this.setPosition(e),this.emitChange()})}unregisterStreetViewEvents(){if(!this.google||!this.googleMap)return;const t=this.googleMap.getStreetView();this.google.maps.event.clearInstanceListeners(t)}updateStreetViewInputs(){if(!this.googleMap)return;const t=this.googleMap.getStreetView(),e=t.getPov();void 0!==e.pitch&&this.pitchInput&&(this.pitchInput.value=e.pitch.toString()),void 0!==e.heading&&this.headingInput&&(this.headingInput.value=e.heading.toString()),this.zoomViewInput&&(this.zoomViewInput.value=t.getZoom().toString()),this.setValue()}toggleStreetView(){this.modeSwitcher?.checked?this.activateStreetView():this.deactivateStreetView(),this.setValue()}activateStreetView(){if(!this.googleMap)return;const t=this.createPanorama();t&&(this.googleMap.setStreetView(t),this.googleMap.setOptions({streetViewControl:!0}),this.registerStreetViewEvents(),this.updateStreetViewInputs(),this.toggleUIElements(),setTimeout(()=>{t.getStatus()!==this.google.maps.StreetViewStatus.OK&&alert("指定の位置にストリートビューがありません。ストリートビューの範囲にペグマンをドロップしてください。")},1e3))}deactivateStreetView(){this.googleMap&&(this.googleMap.setStreetView(null),this.googleMap.setOptions({streetViewControl:!1})),this.resetStreetViewInputs(),this.unregisterStreetViewEvents(),this.toggleUIElements()}resetStreetViewInputs(){this.headingInput&&(this.headingInput.value=""),this.pitchInput&&(this.pitchInput.value=""),this.zoomViewInput&&(this.zoomViewInput.value=""),this.setValue()}toggleUIElements(){const t=this.modeSwitcher?.checked||!1,e=this.container.querySelector(".js-streetview-table"),i=this.container.querySelector(".js-map-table");e&&(e.style.display=t?"block":"none"),i&&(i.style.display=t?"none":"block")}setupSearch(){if(!this.searchInput||!this.searchButton)return;this.searchInput.disabled=!1,this.searchButton.disabled=!1;const t=t=>{t.preventDefault(),this.performSearch()},e=t=>{13===t.keyCode&&(t.preventDefault(),this.searchButton?.click())};this.searchButton.addEventListener("click",t),this.searchInput.addEventListener("keydown",e),this.eventRegistry.set(this.searchButton,[{type:"click",listener:t}]),this.eventRegistry.set(this.searchInput,[{type:"keydown",listener:e}])}async performSearch(){if(!this.google||!this.searchInput||!this.searchButton)return;const t=this.searchInput.value;if(!t)return;this.searchInput.disabled=!0,this.searchButton.disabled=!0;const e=new this.google.maps.Geocoder;try{const i=await new Promise((i,s)=>{e.geocode({address:t},(t,e)=>{e===this.google.maps.GeocoderStatus.OK&&t?i(t):s(new Error(`Geocoding failed: ${e}`))})});i.length>0&&(this.setPosition(i[0].geometry.location),this.emitChange())}catch(t){console.error("Search failed:",t)}finally{this.searchInput.disabled=!1,this.searchButton.disabled=!1}}setPosition(t){this.googleMap&&this.googleMap.panTo(t),this.googleMapMarker&&this.googleMapMarker.setPosition(t);const e=Math.round(1e6*t.lat()),i=Math.round(1e6*t.lng());this.latInput.value=(e/1e6).toString(),this.lngInput.value=(i/1e6).toString(),this.setValue()}setValue(){const t=parseFloat(this.latInput.value)||this.options.defaultValue?.lat||0,e=parseFloat(this.lngInput.value)||this.options.defaultValue?.lng||0,i=parseInt(this.zoomInput.value,10)||this.options.defaultValue?.zoom||14,s=this.headingInput&&(parseFloat(this.headingInput.value)||this.options.defaultValue?.streetView?.heading)||0,o=this.pitchInput&&(parseFloat(this.pitchInput.value)||this.options.defaultValue?.streetView?.pitch)||0,n=this.zoomViewInput&&(parseFloat(this.zoomViewInput.value)||this.options.defaultValue?.streetView?.zoomView)||0,a=this.modeSwitcher&&this.modeSwitcher.checked?"STREETVIEW":"ROADMAP";return this.value={...this.value,type:a,lat:t,lng:e,zoom:i,streetView:{heading:s,pitch:o,zoomView:n}},this}emitChange(){this.options.onChange&&this.options.onChange(this.value)}getMap(){return this.googleMap}destroy(){this.unregisterMapEvents(),this.unregisterStreetViewEvents(),this.googleMapMarker&&this.googleMapMarker.setMap(null);for(const[t,e]of this.eventRegistry)e.forEach(e=>{let{type:i,listener:s,options:o}=e;t.removeEventListener(i,s,o)});this.eventRegistry.clear();const t=this.googleMap?.getDiv();t&&this.mapRoot.removeChild(t),this.googleMap=null,this.googleMapMarker=null,this.google=null}}},49863:function(t,e,i){var s=i(24994);e.default=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.googleMapsPicker)return t.googleMapsPicker;const i=new o.default(t,e);return i.init(),t.googleMapsPicker=i,i};var o=s(i(78385))},64694:function(t,e,i){"use strict";i.r(e),i.d(e,{Loader:function(){return s.a}});var s=i(20467),o=i(80075),n={};for(var a in o)["default","Loader"].indexOf(a)<0&&(n[a]=function(t){return o[t]}.bind(0,a));i.d(e,n)},20467:function(t,e,i){"use strict";i.d(e,{a:function(){return s}});class s{constructor(t=null,e={}){if(this.apiKey=t,this.options=e,"undefined"==typeof window)throw new Error("google-maps is supported only in browser environment")}load(){return void 0!==this.api?Promise.resolve(this.api):void 0!==this.loader?this.loader:(window[s.CALLBACK_NAME]=()=>{if(this.api=window.google,void 0===this.resolve)throw new Error("Should not happen");this.resolve(this.api)},window.gm_authFailure=()=>{if(void 0===this.reject)throw new Error("Should not happen");this.reject(new Error("google-maps: authentication error"))},this.loader=new Promise((t,e)=>{this.resolve=t,this.reject=e;const i=document.createElement("script");i.src=this.createUrl(),i.async=!0,i.onerror=t=>e(t),document.head.appendChild(i)}))}createUrl(){const t=[`callback=${s.CALLBACK_NAME}`];this.apiKey&&t.push(`key=${this.apiKey}`);for(let e in this.options)if(this.options.hasOwnProperty(e)){let i=this.options[e];"version"===e&&(e="v"),"libraries"===e&&(i=i.join(",")),t.push(`${e}=${i}`)}return`https://maps.googleapis.com/maps/api/js?${t.join("&")}`}}s.CALLBACK_NAME="_dk_google_maps_loader_cb"},80075:function(){}}]);