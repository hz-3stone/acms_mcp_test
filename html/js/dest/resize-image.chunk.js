(self.webpackChunkacmsWebpackJsonp=self.webpackChunkacmsWebpackJsonp||[]).push([[8995],{297:function(e,t,r){var s=r(24994);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(r(58475));t.default=class{constructor(e){this.elm=e,this.dropAreaMark=".js-drop_area",this.inputMark=ACMS.Config.resizeImageInputMark,this.previewMark=ACMS.Config.resizeImagePreviewMark,this.targetMark=ACMS.Config.resizeImageTargetMark,this.targetMarkCF=ACMS.Config.resizeImageTargetMarkCF,this.dropSelect=!1,this.dragging=0,this.previewOnly="on"!==ACMS.Config.resizeImage,this.util=new i.default,this.eventListeners=[]}resize(){const e=this.elm.querySelectorAll(this.targetMark);e.length>0?[].forEach.call(e,e=>{this.exec(e)}):this.elm.classList.contains(this.targetMarkCF.substr(1))&&!this.elm.classList.contains("resizeImage")&&(this.elm.classList.add("resizeImage"),this.exec(this.elm))}destroy(){this.eventListeners.forEach(e=>{let{element:t,type:r,handler:s}=e;t.removeEventListener(r,s)}),this.eventListeners=[],this.elm.querySelectorAll(this.previewMark).forEach(e=>{e.remove()}),this.elm.querySelectorAll(".js-img_resize_data").forEach(e=>{e.remove()}),this.elm.classList.remove("resizeImage")}exec(e){const t=e.querySelector(this.previewMark);null!==t&&(this.previewBox=t.cloneNode(!0),e.querySelector(this.previewMark).insertAdjacentHTML("afterend",'<div class="js-img_resize_preview_location" />'),this.listener(e))}listener(e){const t=e.querySelector(this.dropAreaMark);let r=(new Date).getTime()-1500;if(this.dragging=0,t&&window.File&&window.FileReader&&!this.previewOnly){this.banDrag(e),e.querySelector("img").getAttribute("src"),e.querySelector("img").getAttribute("src")||(t.classList.add("drag-n-drop-hover"),setTimeout(()=>{const e=t.querySelector(".acms-admin-drop-area");$(e).fadeOut(200,()=>{t.classList.remove("drag-n-drop-hover"),t.querySelector(".acms-admin-drop-area").style.display=""})},800));const r=r=>{r.stopPropagation(),r.preventDefault(),this.dragging=0,this.dropSelect=!0,t.classList.remove("drag-n-drop-hover");const{files:s}=r.dataTransfer;let i=!1;for(let e=0;e<s.length;e++)if("image/gif"===s[e].type){i=!0;break}return i&&!window.confirm(ACMS.i18n("drop_select_gif_image.alert"))||this.readFiles(r.dataTransfer.files,e),!1};t.addEventListener("drop",r,!1),this.eventListeners.push({element:t,type:"drop",handler:r});const s=e=>(e.stopPropagation(),e.preventDefault(),t.classList.add("drag-n-drop-hover"),!1);t.addEventListener("dragover",s,!1),this.eventListeners.push({element:t,type:"dragover",handler:s});const i=e=>(e.stopPropagation(),e.preventDefault(),this.dragging++,t.classList.add("drag-n-drop-hover"),!1);t.addEventListener("dragenter",i,!1),this.eventListeners.push({element:t,type:"dragenter",handler:i});const a=e=>(e.stopPropagation(),e.preventDefault(),this.dragging--,0===this.dragging&&t.classList.remove("drag-n-drop-hover"),!1);t.addEventListener("dragleave",a,!1),this.eventListeners.push({element:t,type:"dragleave",handler:a})}e.querySelectorAll(this.inputMark).forEach(t=>{const s=t=>{r+1500<=(new Date).getTime()&&(r=(new Date).getTime(),this.readFiles(t.target.files,e))};t.addEventListener("change",s),this.eventListeners.push({element:t,type:"change",handler:s})})}readFiles(e,t){const r=t.querySelectorAll("[name^=image_size_]"),s=document.querySelectorAll(".js-banner_size_large"),i=document.querySelector(".js-banner_size_large_criterion"),a=r.length>0&&r[0].value.length<2;if(r.length>1)return!1;s.length>=1&&s.value&&(ACMS.Config.lgImg=`${i.value}:${s[0].value}`),[].forEach.call(t.querySelectorAll(this.previewMark),e=>{e.parentNode.removeChild(e)}),[].forEach.call(t.querySelectorAll(".js-img_resize_data"),e=>{e.parentNode.removeChild(e)});const n=ACMS.Config.lgImg.split(":"),l=n[0];let o=n[1];a&&(o=999999999);for(let r=0;r<e.length;r++){const s=e[r];s&&this.util.getDataUrlFromFile(s,l,o).then(e=>{const{dataUrl:r}=e;let{resize:i}=e;a&&(i=!1),this.dropSelect||"image/gif"!==s.type||(i=!1),this.previewOnly&&(i=!1),this.set(t,r,i||this.dropSelect)})}}banDrag(e){[].forEach.call(e.querySelectorAll("img"),e=>{const t=e=>{e.preventDefault()},r=e=>{e.preventDefault()};e.addEventListener("mousedown",t),e.addEventListener("mouseup",r),this.eventListeners.push({element:e,type:"mousedown",handler:t},{element:e,type:"mouseup",handler:r})})}reduce(e,t){if(e>t)return Math.floor(e/t);const r=e,s=t;let i;for(;i=e%t,0!==i;)t=e,e=i;return`${Math.floor(r/e)}/${Math.floor(s/e)}`}set(e,t,r){this.previewBox||(this.previewBox=e.querySelector(this.previewMark).cloneNode(!0),[].forEach.call(e.querySelectorAll(this.previewMark),e=>{e.parentNode.removeChild(e)}),[].forEach.call(e.querySelectorAll(".js-img_resize_data"),e=>{e.parentNode.removeChild(e)}));const s=this.previewBox.cloneNode(!0);s.style.display="",s.setAttribute("src",t),e.querySelector(".js-img_resize_preview_location").insertAdjacentHTML("beforebegin",s.outerHTML),[].forEach.call(e.querySelectorAll(".js-img_resize_preview_old"),e=>{e.parentNode.removeChild(e)});const i=e.querySelector(".js-img_data_url");i&&i.setAttribute("data-src",t),this.banDrag(e);const a=e.querySelector(this.inputMark);if(r){const t=e.querySelector(this.inputMark);t&&(t.value="")}else t="";const n=a.getAttribute("name"),l=document.createElement("input");l.classList.add("js-img_resize_data"),l.setAttribute("type","hidden"),l.setAttribute("accept","image/*"),l.setAttribute("type","hidden"),l.setAttribute("name",n),l.value=t;const o=e.querySelector(".js-img_resize_dummy");o&&o.remove(),e.querySelector(this.inputMark).insertAdjacentHTML("afterend",l.outerHTML)}}}}]);